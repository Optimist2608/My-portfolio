// download.js - –°–∏—Å—Ç–µ–º–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
const downloadConfig = {
    'easy': {
        title: '–õ–µ–≥–∫–∏–µ –ø—Ä–æ–µ–∫—Ç—ã',
        items: [
            {
                id: 'easy-1',
                title: '–ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å HTML –∏ CSS(1)',
                description: '–ü–µ—Ä–≤—ã–π —Å–∞–π—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã–π –≤–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è',
                downloadLink: './light_work/work1.zip',
                requirements: ['HTML', 'CSS'],
                size: '2.4 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-2',
                title: '–ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å HTML –∏ CSS(2)',
                downloadLink: './light_work/work2.zip',
                requirements: ['HTML', 'CSS'],
                size: '3.1 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-3',
                title: '–ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å HTML –∏ CSS(3)',
                downloadLink: './light_work/work3.zip',
                requirements: ['HTML', 'CSS'],
                size: '1.8 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-4',
                title: '–ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å HTML –∏ CSS(4)',
                downloadLink: './light_work/work4.zip',
                requirements: ['HTML', 'CSS'],
                size: '2.7 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-5',
                title: '–®—Ä–∏—Ñ—Ç—ã',
                downloadLink: './light_work/work5.zip',
                requirements: ['HTML', 'CSS', '–®—Ä–∏—Ñ—Ç—ã'],
                size: '4.2 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-6',
                title: '–¢–∞–±–ª–∏—Ü—ã(1)',
                downloadLink: './light_work/work6.zip',
                requirements: ['HTML', 'CSS', '–¢–∞–±–ª–∏—Ü—ã'],
                size: '1.9 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-7',
                title: '–¢–∞–±–ª–∏—Ü—ã(2)',
                downloadLink: './light_work/work7.zip',
                requirements: ['HTML', 'CSS', '–¢–∞–±–ª–∏—Ü—ã'],
                size: '2.3 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-8',
                title: '–¶–≤–µ—Ç —Ñ–æ–Ω–∞(1)',
                downloadLink: './light_work/work8.zip',
                requirements: ['HTML', 'CSS', '–ì—Ä–∞–¥–∏–µ–Ω—Ç—ã'],
                size: '1.5 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-9',
                title: '–¶–≤–µ—Ç —Ñ–æ–Ω–∞(2)',
                downloadLink: './light_work/work9.zip',
                requirements: ['HTML', 'CSS', '–ì—Ä–∞–¥–∏–µ–Ω—Ç—ã'],
                size: '2.1 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-10',
                title: '–ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ',
                downloadLink: './light_work/work10.zip',
                requirements: ['HTML', 'CSS', 'Flexbox'],
                size: '3.4 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-11',
                title: '–ü—Å–µ–≤–¥–æ–∫–ª–∞—Å—Å—ã ":hover, :has, :visited"',
                downloadLink: './light_work/work11.zip',
                requirements: ['HTML', 'CSS', '–ü—Å–µ–≤–¥–æ–∫–ª–∞—Å—Å—ã'],
                size: '2.8 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-12',
                title: '–ü—Å–µ–≤–¥–æ–∫–ª–∞—Å—Å—ã ":after :before"',
                downloadLink: './light_work/work12.zip',
                requirements: ['HTML', 'CSS', '–ü—Å–µ–≤–¥–æ–∫–ª–∞—Å—Å—ã'],
                size: '3.2 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-13',
                title: '–ü—Å–µ–≤–¥–æ–∫–ª–∞—Å—Å ":child"',
                downloadLink: './light_work/work13.zip',
                requirements: ['HTML', 'CSS', '–ü—Å–µ–≤–¥–æ–∫–ª–∞—Å—Å—ã'],
                size: '2.6 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-14',
                title: 'Flex(1)',
                downloadLink: './light_work/work14.zip',
                requirements: ['HTML', 'CSS', 'Flexbox'],
                size: '3.9 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-15',
                title: 'Flex(2)',
                downloadLink: './light_work/work15.zip',
                requirements: ['HTML', 'CSS', 'Flexbox'],
                size: '4.1 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-16',
                title: 'Float',
                downloadLink: './light_work/work16.zip',
                requirements: ['HTML', 'CSS', 'Float'],
                size: '2.5 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-17',
                title: '–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è(1)',
                downloadLink: './light_work/work17.zip',
                requirements: ['HTML', 'CSS', 'Transform'],
                size: '3.7 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-18',
                title: '–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è(2)',
                downloadLink: './light_work/work18.zip',
                requirements: ['HTML', 'CSS', 'Transform'],
                size: '4.0 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-19',
                title: '–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è(3)',
                downloadLink: './light_work/work19.zip',
                requirements: ['HTML', 'CSS', 'Transform'],
                size: '3.8 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-20',
                title: '–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è(4)',
                downloadLink: './light_work/work20.zip',
                requirements: ['HTML', 'CSS', 'Transform'],
                size: '4.3 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-21',
                title: '–ê–Ω–∏–º–∞—Ü–∏–∏',
                downloadLink: './light_work/work21.zip',
                requirements: ['HTML', 'CSS', 'Animations'],
                size: '5.2 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-22',
                title: '–°–ø—Ä–∞–π—Ç—ã',
                downloadLink: './light_work/work22.zip',
                requirements: ['HTML', 'CSS', 'Sprite'],
                size: '6.1 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-23',
                title: '–°–ø—Ä–∞–π—Ç –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π',
                downloadLink: './light_work/work23.zip',
                requirements: ['HTML', 'CSS', 'Sprite', 'Animations'],
                size: '7.3 MB',
                icon: './img/head_title/html.png'
            },
            {
                id: 'easy-24',
                title: '–í–µ–∫—Ç–æ—Ä–Ω–∞—è –≥—Ä–∞—Ñ–∏–∫–∞',
                downloadLink: './light_work/work24.zip',
                requirements: ['HTML', 'CSS', 'SVG'],
                size: '5.8 MB',
                icon: './img/head_title/html.png'
            }
        ]
    },
    'medium': {
        title: '–°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç—ã',
        items: []
    },
    'hard': {
        title: '–°–ª–æ–∂–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã',
        items: []
    }
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
function initDownloadSystem() {
    renderDownloadList();
    setupDownloadEventListeners();
}

// –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–π
function renderDownloadList() {
    const outputTab = document.getElementById('output-tab');
    if (!outputTab) return;
    
    outputTab.innerHTML = '';
    
    // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–ø–∏—Å–∫–∞
    const container = document.createElement('div');
    container.className = 'download-container';
    
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
    const header = document.createElement('h2');
    header.textContent = '–°–∫–∞—á–∞—Ç—å –º–æ–∏ —Ä–∞–±–æ—Ç—ã';
    header.className = 'download-header';
    container.appendChild(header);
    
    // –û–ø–∏—Å–∞–Ω–∏–µ
    const description = document.createElement('p');
    description.textContent = '–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã —É–ø–∞–∫–æ–≤–∞–Ω—ã –≤ ZIP-–∞—Ä—Ö–∏–≤—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—é. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞—Ä—Ö–∏–≤–∞.';
    description.className = 'download-description';
    container.appendChild(description);
    
    // –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ —É—Ä–æ–≤–Ω—è–º
    Object.keys(downloadConfig).forEach(level => {
        const levelConfig = downloadConfig[level];
        if (levelConfig.items.length === 0) return;
        
        // –°–µ–∫—Ü–∏—è —É—Ä–æ–≤–Ω—è
        const levelSection = document.createElement('div');
        levelSection.className = 'download-level-section';
        
        // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —É—Ä–æ–≤–Ω—è
        const levelHeader = document.createElement('h3');
        levelHeader.textContent = levelConfig.title;
        levelHeader.className = 'download-level-header';
        levelSection.appendChild(levelHeader);
        
        // –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤
        const counter = document.createElement('span');
        counter.className = 'download-counter';
        counter.textContent = `${levelConfig.items.length} –ø—Ä–æ–µ–∫—Ç–æ–≤`;
        levelHeader.appendChild(counter);
        
        // –°–µ—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤
        const grid = document.createElement('div');
        grid.className = 'download-grid';
        
        // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–µ–∫—Ç—ã –≤ —Å–µ—Ç–∫—É
        levelConfig.items.forEach(project => {
            const projectCard = createProjectCard(project, level);
            grid.appendChild(projectCard);
        });
        
        levelSection.appendChild(grid);
        container.appendChild(levelSection);
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–æ—Ä–º–∞—Ç–∞—Ö
    const formatInfo = document.createElement('div');
    formatInfo.className = 'download-info';
    formatInfo.innerHTML = `
        <h4>üì¶ –§–æ—Ä–º–∞—Ç—ã —Ñ–∞–π–ª–æ–≤</h4>
        <ul>
            <li><strong>.zip</strong> - –ê—Ä—Ö–∏–≤ —Å –ø—Ä–æ–µ–∫—Ç–æ–º (—Å–æ–¥–µ—Ä–∂–∏—Ç HTML, CSS, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)</li>
            <li><strong>.html</strong> - –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –ø—Ä–æ–µ–∫—Ç–∞</li>
            <li><strong>.css</strong> - –°—Ç–∏–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞</li>
            <li><strong>.js</strong> - JavaScript —Ñ–∞–π–ª—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)</li>
        </ul>
    `;
    container.appendChild(formatInfo);
    
    // –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
    const instructions = document.createElement('div');
    instructions.className = 'download-instructions';
    instructions.innerHTML = `
        <h4>‚ö° –ö–∞–∫ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç:</h4>
        <ol>
            <li>–°–∫–∞—á–∞–π—Ç–µ ZIP-–∞—Ä—Ö–∏–≤ –ø—Ä–æ–µ–∫—Ç–∞</li>
            <li>–†–∞–∑–∞—Ä—Ö–∏–≤–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –≤ –Ω—É–∂–Ω—É—é –ø–∞–ø–∫—É</li>
            <li>–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª <code>index.html</code> –≤ –±—Ä–∞—É–∑–µ—Ä–µ</li>
            <li>–î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª—ã –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ</li>
        </ol>
    `;
    container.appendChild(instructions);
    
    outputTab.appendChild(container);
}

// –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
function createProjectCard(project, level) {
    const card = document.createElement('div');
    card.className = 'download-card';
    card.setAttribute('data-project-id', project.id);
    card.setAttribute('data-project-level', level);
    
    // –ò–∫–æ–Ω–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
    const iconDiv = document.createElement('div');
    iconDiv.className = 'download-card-icon';
    const icon = document.createElement('img');
    icon.src = project.icon || './img/head_title/html.png';
    icon.alt = project.title;
    iconDiv.appendChild(icon);
    
    // –ö–æ–Ω—Ç–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏
    const content = document.createElement('div');
    content.className = 'download-card-content';
    
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
    const title = document.createElement('h4');
    title.textContent = project.title;
    content.appendChild(title);
    
    // –û–ø–∏—Å–∞–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    if (project.description) {
        const desc = document.createElement('p');
        desc.textContent = project.description;
        desc.className = 'download-card-desc';
        content.appendChild(desc);
    }
    
    // –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
    if (project.requirements && project.requirements.length > 0) {
        const techDiv = document.createElement('div');
        techDiv.className = 'download-card-tech';
        project.requirements.forEach(tech => {
            const techSpan = document.createElement('span');
            techSpan.className = 'tech-tag';
            techSpan.textContent = tech;
            techDiv.appendChild(techSpan);
        });
        content.appendChild(techDiv);
    }
    
    // –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
    if (project.size) {
        const sizeDiv = document.createElement('div');
        sizeDiv.className = 'download-card-size';
        const sizeIcon = document.createElement('span');
        sizeIcon.textContent = 'üì¶ ';
        const sizeText = document.createElement('span');
        sizeText.textContent = project.size;
        sizeDiv.appendChild(sizeIcon);
        sizeDiv.appendChild(sizeText);
        content.appendChild(sizeDiv);
    }
    
    // –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
    const buttonDiv = document.createElement('div');
    buttonDiv.className = 'download-card-button';
    const button = document.createElement('button');
    button.className = 'download-btn';
    button.setAttribute('data-download-link', project.downloadLink);
    button.setAttribute('data-project-title', project.title);
    
    const buttonIcon = document.createElement('img');
    buttonIcon.src = './img/footer/download-icon.png';
    buttonIcon.alt = '–°–∫–∞—á–∞—Ç—å';
    buttonIcon.className = 'download-btn-icon';
    
    const buttonText = document.createElement('span');
    buttonText.textContent = '–°–∫–∞—á–∞—Ç—å';
    
    button.appendChild(buttonIcon);
    button.appendChild(buttonText);
    buttonDiv.appendChild(button);
    
    // –°–æ–±–∏—Ä–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É
    card.appendChild(iconDiv);
    card.appendChild(content);
    card.appendChild(buttonDiv);
    
    return card;
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
function setupDownloadEventListeners() {
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
    document.addEventListener('click', function(e) {
        const downloadBtn = e.target.closest('.download-btn');
        if (downloadBtn) {
            e.preventDefault();
            e.stopPropagation();
            
            const downloadLink = downloadBtn.getAttribute('data-download-link');
            const projectTitle = downloadBtn.getAttribute('data-project-title');
            
            if (downloadLink) {
                triggerDownload(downloadLink, projectTitle);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                showDownloadNotification(projectTitle);
            }
        }
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏–π
    document.addEventListener('download-started', function(e) {
        console.log('–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –Ω–∞—á–∞—Ç–æ:', e.detail.filename);
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–π
    document.addEventListener('download-completed', function(e) {
        updateDownloadStats(e.detail.projectId);
    });
}

// –ó–∞–ø—É—Å–∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
function triggerDownload(url, filename) {
    // –°–æ–∑–¥–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –Ω–∞—á–∞–ª–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
    const startEvent = new CustomEvent('download-started', {
        detail: { filename: filename, url: url, timestamp: new Date() }
    });
    document.dispatchEvent(startEvent);
    
    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
    const link = document.createElement('a');
    link.href = url;
    link.download = filename ? `${filename}.zip` : 'project.zip';
    link.style.display = 'none';
    
    // –î–æ–±–∞–≤–ª—è–µ–º –≤ DOM –∏ –∫–ª–∏–∫–∞–µ–º
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    // –°–æ–∑–¥–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
    setTimeout(() => {
        const completeEvent = new CustomEvent('download-completed', {
            detail: { 
                filename: filename, 
                url: url, 
                timestamp: new Date(),
                projectId: getProjectIdFromUrl(url)
            }
        });
        document.dispatchEvent(completeEvent);
    }, 100);
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ ID –ø—Ä–æ–µ–∫—Ç–∞ –∏–∑ URL
function getProjectIdFromUrl(url) {
    const match = url.match(/\/(work\d+)\./);
    return match ? match[1] : null;
}

// –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏
function showDownloadNotification(projectTitle) {
    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    const existingNotification = document.querySelector('.download-notification');
    if (existingNotification) {
        existingNotification.remove();
    }
    
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    const notification = document.createElement('div');
    notification.className = 'download-notification';
    
    const icon = document.createElement('img');
    icon.src = './img/footer/download-success.png';
    icon.alt = '–£—Å–ø–µ—à–Ω–æ';
    icon.className = 'download-notification-icon';
    
    const text = document.createElement('span');
    text.textContent = `–°–∫–∞—á–∏–≤–∞–Ω–∏–µ "${projectTitle}" –Ω–∞—á–∞—Ç–æ`;
    
    const closeBtn = document.createElement('button');
    closeBtn.innerHTML = '&times;';
    closeBtn.className = 'download-notification-close';
    closeBtn.addEventListener('click', () => {
        notification.remove();
    });
    
    notification.appendChild(icon);
    notification.appendChild(text);
    notification.appendChild(closeBtn);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –≤ body
    document.body.appendChild(notification);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    setTimeout(() => {
        notification.classList.add('show');
    }, 10);
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
        if (notification.parentNode) {
            notification.classList.remove('show');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 300);
        }
    }, 5000);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–π
function updateDownloadStats(projectId) {
    let downloadStats = JSON.parse(localStorage.getItem('download-stats') || '{}');
    
    if (!downloadStats[projectId]) {
        downloadStats[projectId] = {
            count: 0,
            lastDownload: null,
            firstDownload: new Date().toISOString()
        };
    }
    
    downloadStats[projectId].count++;
    downloadStats[projectId].lastDownload = new Date().toISOString();
    
    localStorage.setItem('download-stats', JSON.stringify(downloadStats));
    
    console.log(`–ü—Ä–æ–µ–∫—Ç ${projectId} —Å–∫–∞—á–∞–Ω ${downloadStats[projectId].count} —Ä–∞–∑(–∞)`);
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–π
function getDownloadStats() {
    return JSON.parse(localStorage.getItem('download-stats') || '{}');
}

// –≠–∫—Å–ø–æ—Ä—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
function exportDownloadStats() {
    const stats = getDownloadStats();
    const dataStr = JSON.stringify(stats, null, 2);
    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
    
    const exportFileDefaultName = 'download-stats.json';
    
    const linkElement = document.createElement('a');
    linkElement.setAttribute('href', dataUri);
    linkElement.setAttribute('download', exportFileDefaultName);
    linkElement.click();
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –¥—Ä—É–≥–∏—Ö —Å–∏—Å—Ç–µ–º
    setTimeout(() => {
        initDownloadSystem();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–æ–≤ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
        checkDownloadFiles();
        
        console.log('–°–∏—Å—Ç–µ–º–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
    }, 1000);
});

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
async function checkDownloadFiles() {
    console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è...');
    
    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ fetch
    // –ù–æ —ç—Ç–æ —Ç—Ä–µ–±—É–µ—Ç CORS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
    
    // –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º
    Object.keys(downloadConfig).forEach(level => {
        const levelConfig = downloadConfig[level];
        console.log(`${levelConfig.title}: ${levelConfig.items.length} –ø—Ä–æ–µ–∫—Ç–æ–≤ –¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è`);
    });
}